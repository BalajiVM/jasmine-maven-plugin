<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AbstractJasmineMojo.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jasmine-maven-plugin</a> &gt; <a href="index.html" class="el_package">com.github.searls.jasmine.mojo</a> &gt; <span class="el_source">AbstractJasmineMojo.java</span></div><h1>AbstractJasmineMojo.java</h1><pre class="source lang-java linenums">package com.github.searls.jasmine.mojo;

import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.MojoFailureException;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.project.MavenProject;

import com.github.searls.jasmine.config.JasmineConfiguration;
import com.github.searls.jasmine.exception.StringifiesStackTraces;
import com.github.searls.jasmine.io.ScansDirectory;
import com.github.searls.jasmine.model.ScriptSearch;
import com.github.searls.jasmine.runner.SpecRunnerTemplate;

<span class="fc" id="L20">public abstract class AbstractJasmineMojo extends AbstractMojo implements JasmineConfiguration {</span>

  private static final String ERROR_FILE_DNE = &quot;Invalid value for parameter '%s'. File does not exist: %s&quot;;

  // Properties in order of most-to-least interesting for client projects to override

  /**
   * Directory storing your JavaScript.
   * @since 1.1.0
   */
  @Parameter(
      property=&quot;jsSrcDir&quot;,
      defaultValue=&quot;${project.basedir}${file.separator}src${file.separator}main${file.separator}javascript&quot;)
  private File jsSrcDir;

  /**
   * Directory storying your Jasmine Specs.
   * @since 1.1.0
   */
  @Parameter(
      property=&quot;jsTestSrcDir&quot;,
      defaultValue=&quot;${project.basedir}${file.separator}src${file.separator}test${file.separator}javascript&quot;)
  private File jsTestSrcDir;

  /**
   * Determines the Selenium WebDriver class we'll use to execute the tests. See the Selenium documentation for more details.
   * The plugin uses &lt;a href=&quot;http://htmlunit.sourceforge.net/&quot;&gt;HtmlUnit&lt;/a&gt; by default.
   *
   * &lt;p&gt;Some valid examples:&lt;/p&gt;
   * &lt;ul&gt;
   *   &lt;li&gt;org.openqa.selenium.htmlunit.HtmlUnitDriver&lt;/li&gt;
   *   &lt;li&gt;org.openqa.selenium.firefox.FirefoxDriver&lt;/li&gt;
   *   &lt;li&gt;org.openqa.selenium.ie.InternetExplorerDriver&lt;/li&gt;
   * &lt;/ul&gt;
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;org.openqa.selenium.htmlunit.HtmlUnitDriver&quot;)
  protected String webDriverClassName;

  /**
   * &lt;p&gt;Determines the browser and version profile that HtmlUnit will simulate. This setting does nothing if the plugin is configured not to use HtmlUnit.
   * This maps 1-to-1 with the public static instances found in {@link com.gargoylesoftware.htmlunit.BrowserVersion}.&lt;/p&gt;
   *
   * &lt;p&gt;Some valid examples: CHROME, FIREFOX_3_6, INTERNET_EXPLORER_7, INTERNET_EXPLORER_8, INTERNET_EXPLORER_9&lt;/p&gt;
   *
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;FIREFOX_3_6&quot;)
  protected String browserVersion;

  /**
   * &lt;p&gt;Determines the format that jasmine:test will print to console.&lt;/p&gt;
   * &lt;p&gt;Valid options:&lt;/p&gt;
   * &lt;ul&gt;
   *   &lt;li&gt;&quot;documentation&quot; - (default) - print specs in a nested format&lt;/li&gt;
   *   &lt;li&gt;&quot;progress&quot; - more terse, with a period for a passed specs and an 'F' for failures (e.g. '...F...')&lt;/li&gt;
   * &lt;/ul&gt;
   *
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;documentation&quot;)
  protected String format;

  /**
   * &lt;p&gt;JavaScript sources (typically vendor/lib dependencies) that need to be loaded
   * before other sources (and specs) in a particular order. Each source will first be
   * searched for relative to &lt;code&gt;${jsSrcDir}&lt;/code&gt;, then &lt;code&gt;${jsTestSrcDir}&lt;/code&gt;,
   * then (if it's not found in either) it will be included exactly as it appears in your POM.&lt;/p&gt;
   *
   * &lt;p&gt;Therefore, if jquery.js is in &lt;code&gt;${jsSrcDir}/vendor&lt;/code&gt;, you would configure:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;preloadSources&amp;gt;
   *   &amp;lt;source&amp;gt;vendor/jquery.js&amp;lt;/source&amp;gt;
   * &amp;lt;/preloadSources&amp;gt;
   * &lt;/pre&gt;
   * 
   * &lt;p&gt;And jquery.js would load before all the other sources and specs.&lt;/p&gt;
   * 
   * @since 1.1.0
   */
  @Parameter
  protected List&lt;String&gt; preloadSources;

  /**
   * &lt;p&gt;It may be the case that the jasmine-maven-plugin doesn't currently suit all of your needs,
   * and as a result the generated SpecRunner HTML files are set up in a way that you can't run
   * your specs. Have no fear! Simply specify a custom spec runner template in the plugin configuration
   * and make the changes you need. The default template is stored in &lt;code&gt;src/main/resources/jasmine-templates/SpecRunner.htmltemplate&lt;/code&gt;,
   * and the required template strings are tokenized in &quot;$*$&quot; patterns.&lt;/p&gt;
   *
   * &lt;p&gt;Example usage:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;customRunnerTemplate&amp;gt;${project.basedir}/src/test/resources/myCustomRunner.template&amp;lt;/customRunnerTemplate&amp;gt;
   * &lt;/pre&gt;
   *
   * @since 1.1.0
   */
  @Parameter
  protected File customRunnerTemplate;

  /**
   * &lt;p&gt;Sometimes you want to have full control over how scriptloaders are configured. In order to interpolate custom configuration
   * into the generated runnerTemplate, specify a file containing the additional config.&lt;/p&gt;
   *
   * &lt;p&gt;Example usage:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;customRunnerConfiguration&amp;gt;${project.basedir}/src/test/resources/myCustomConfig.txt&amp;lt;/customRunnerConfiguration&amp;gt;
   * &lt;/pre&gt;
   *
   * @since 1.1.0
   */
  @Parameter
  protected File customRunnerConfiguration;

  /**
   * Target directory for files created by the plugin.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;${project.build.directory}${file.separator}jasmine&quot;)
  protected File jasmineTargetDir;


  /**
   * Skip the tests.
   * 
   * @since 1.1.0
   */
  @Parameter(property=&quot;skipTests&quot;)
  protected boolean skipTests;

  /**
   * Halt the build on test failure.
   * 
   * @since 1.1.0
   */
  @Parameter(property=&quot;haltOnFailure&quot;, defaultValue=&quot;true&quot;)
  protected boolean haltOnFailure;

  /**
   * Timeout for spec execution in seconds.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;300&quot;)
  protected int timeout;

  /**
   * True to increase HtmlUnit output and attempt reporting on specs even if a timeout occurred.
   *
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;false&quot;)
  protected boolean debug;

  /**
   * The name of the Spec Runner file.
   *
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;SpecRunner.html&quot;)
  protected String specRunnerHtmlFileName;

  /**
   * The name of the Manual Spec Runner.
   *
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;ManualSpecRunner.html&quot;)
  protected String manualSpecRunnerHtmlFileName;

  /**
   * The name of the generated JUnit XML report.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;TEST-jasmine.xml&quot;)
  protected String junitXmlReportFileName;

  /**
   * The name of the directory the specs will be deployed to on the server.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;spec&quot;)
  protected String specDirectoryName;

  /**
   * The name of the directory the sources will be deployed to on the server.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;src&quot;)
  protected String srcDirectoryName;

  /**
   * The source encoding.
   * 
   * @since 1.1.0
   */
  @Parameter(defaultValue=&quot;${project.build.sourceEncoding}&quot;)
  protected String sourceEncoding;

  /**
   * Keep the server alive after the &lt;code&gt;jasmine:test&lt;/code&gt; goal exists.
   * Useful if you need to run further analysis on your tests, like collecting code coverage.
   * 
   * @since 1.3.1.0
   */
  @Parameter(property=&quot;keepServerAlive&quot;, defaultValue=&quot;false&quot;)
  protected boolean keepServerAlive;

  /**
   * &amp;lt;sourceIncludes&amp;gt;
   *   &amp;lt;include&amp;gt;vendor/&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;myBootstrapFile.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
   * &amp;lt;/sourceIncludes&amp;gt;
   * &lt;/pre&gt;
   * 
   * &lt;p&gt;Default &lt;code&gt;sourceIncludes&lt;/code&gt;:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;sourceIncludes&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
   * &amp;lt;/sourceIncludes&amp;gt;
   * &lt;/pre&gt;
   * 
   * @since 1.1.0
   */
<span class="fc" id="L251">  @Parameter</span>
  private final List&lt;String&gt; sourceIncludes = ScansDirectory.DEFAULT_INCLUDES;

  /**
   * &lt;p&gt;Just like &lt;code&gt;sourceIncludes&lt;/code&gt;, but will exclude anything matching the provided patterns.&lt;/p&gt;
   * &lt;p&gt;There are no &lt;code&gt;sourceExcludes&lt;/code&gt; by default.&lt;/p&gt;
   * 
   * @since 1.1.0
   */
<span class="fc" id="L260">  @Parameter</span>
  private final List&lt;String&gt; sourceExcludes = Collections.emptyList();

  /**
   * &lt;p&gt;I often find myself needing control of the spec include order
   * when I have some global spec helpers or spec-scoped dependencies, like:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;specIncludes&amp;gt;
   *   &amp;lt;include&amp;gt;jasmine-jquery.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;spec-helper.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
   * &amp;lt;/specIncludes&amp;gt;
   * &lt;/pre&gt;
   * 
   * &lt;p&gt;Default &lt;code&gt;specIncludes&lt;/code&gt;:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;specIncludes&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
   *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
   * &amp;lt;/specIncludes&amp;gt;
   * &lt;/pre&gt;
   * 
   * @since 1.1.0
   */
<span class="fc" id="L285">  @Parameter</span>
  private final List&lt;String&gt; specIncludes = ScansDirectory.DEFAULT_INCLUDES;

  /**
   * &lt;p&gt;Just like &lt;code&gt;specIncludes&lt;/code&gt;, but will exclude anything matching the provided patterns.&lt;/p&gt;
   * &lt;p&gt;There are no &lt;code&gt;specExcludes&lt;/code&gt; by default.&lt;/p&gt;
   * 
   * @since 1.1.0
   */
<span class="fc" id="L294">  @Parameter</span>
  private final List&lt;String&gt; specExcludes = Collections.emptyList();

  /**
   * &lt;p&gt;Used by the &lt;code&gt;jasmine:bdd&lt;/code&gt; goal to specify port to run the server under.&lt;/p&gt;
   * 
   * &lt;p&gt;The &lt;code&gt;jasmine:test&lt;/code&gt; goal always uses a random available port so this property is ignored.&lt;/p&gt;
   * 
   * @since 1.1.0
   */
  @Parameter(property=&quot;jasmine.serverPort&quot;, defaultValue=&quot;8234&quot;)
  protected int serverPort;

  /**
   * &lt;p&gt;Determines the strategy to use when generation the JasmineSpecRunner. This feature allows for custom
   * implementation of the runner generator. Typically this is used when using different script runners.&lt;/p&gt;
   *
   * &lt;p&gt;Some valid examples: DEFAULT, REQUIRE_JS&lt;/p&gt;
   * 
   * @since 1.1.0
   */
  @Parameter(property=&quot;jasmine.specRunnerTemplate&quot;, defaultValue=&quot;DEFAULT&quot;)
  protected SpecRunnerTemplate specRunnerTemplate;

  /**
   * &lt;p&gt;Path to loader script, relative to jsSrcDir. Defaults to jsSrcDir/nameOfScript.js. Which script to look for is determined by
   * the selected spcRunnerTemplate. I.e require.js is used when REQUIRE_JS is selected as specRunnerTemplate.&lt;/p&gt;
   *
   * @since 1.1.0
   * @deprecated Specify script loader path using the &lt;code&gt;preloadSources&lt;/code&gt; parameter instead.
   */
  @Parameter
  @Deprecated
  protected String scriptLoaderPath;

  @Parameter(defaultValue=&quot;${project}&quot;, readonly=true)

  protected MavenProject mavenProject;

  protected ScriptSearch sources;
  protected ScriptSearch specs;

<span class="fc" id="L336">  protected StringifiesStackTraces stringifiesStackTraces = new StringifiesStackTraces();</span>

  @Override
  public final void execute() throws MojoExecutionException, MojoFailureException {
<span class="fc" id="L340">    validateParameters();</span>

<span class="fc" id="L342">    this.sources = new ScriptSearch(this.jsSrcDir,this.sourceIncludes,this.sourceExcludes);</span>
<span class="fc" id="L343">    this.specs = new ScriptSearch(this.jsTestSrcDir,this.specIncludes,this.specExcludes);</span>

    try {
<span class="fc" id="L346">      this.run();</span>
<span class="fc" id="L347">    } catch(MojoFailureException e) {</span>
<span class="fc" id="L348">      throw e;</span>
<span class="fc" id="L349">    } catch(Exception e) {</span>
<span class="fc" id="L350">      throw new MojoExecutionException(&quot;The jasmine-maven-plugin encountered an exception: \n&quot;+this.stringifiesStackTraces.stringify(e),e);</span>
<span class="fc" id="L351">    }</span>
<span class="fc" id="L352">  }</span>

  public abstract void run() throws Exception;

  @Override
  public String getSourceEncoding() {
<span class="fc" id="L358">    return this.sourceEncoding;</span>
  }

  @Override
  public File getCustomRunnerTemplate() {
<span class="fc" id="L363">    return this.customRunnerTemplate;</span>
  }

  @Override
  public SpecRunnerTemplate getSpecRunnerTemplate() {
<span class="nc" id="L368">    return this.specRunnerTemplate;</span>
  }

  @Override
  public File getJasmineTargetDir() {
<span class="nc" id="L373">    return this.jasmineTargetDir;</span>
  }

  @Override
  public String getSrcDirectoryName() {
<span class="nc" id="L378">    return this.srcDirectoryName;</span>
  }

  @Override
  public ScriptSearch getSources() {
<span class="nc" id="L383">    return this.sources;</span>
  }

  @Override
  public ScriptSearch getSpecs() {
<span class="nc" id="L388">    return this.specs;</span>
  }

  @Override
  public String getSpecDirectoryName() {
<span class="nc" id="L393">    return this.specDirectoryName;</span>
  }

  @Override
  public List&lt;String&gt; getPreloadSources() {
<span class="nc" id="L398">    this.addRequireJsIfNecessary(); // This is temporary until the scriptLoaderPath parameter is removed</span>
<span class="nc" id="L399">    return this.preloadSources;</span>
  }

  private void addRequireJsIfNecessary() {
<span class="nc bnc" id="L403" title="All 2 branches missed.">    String scriptLoaderPath = this.getScriptLoaderPath() == null ? &quot;require.js&quot; : this.getScriptLoaderPath();</span>
<span class="nc" id="L404">    String requireJsPath = String.format(&quot;%s/%s&quot;, this.jsSrcDir, scriptLoaderPath);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">    if (SpecRunnerTemplate.REQUIRE_JS.equals(this.specRunnerTemplate)) {</span>
<span class="nc" id="L406">      File requireJsFile = new File(requireJsPath);</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">      if (requireJsFile.exists()) {</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (this.preloadSources == null) {</span>
<span class="nc" id="L409">          this.preloadSources = new ArrayList&lt;String&gt;();</span>
        }
<span class="nc" id="L411">        this.preloadSources.add(requireJsPath);</span>
      }
    }
<span class="nc" id="L414">  }</span>

  public MavenProject getMavenProject() {
<span class="fc" id="L417">    return this.mavenProject;</span>
  }

  @Override
  public File getCustomRunnerConfiguration() {
<span class="fc" id="L422">    return this.customRunnerConfiguration;</span>
  }

  @Deprecated
  @Override
  public String getScriptLoaderPath() {
<span class="fc" id="L428">    return this.scriptLoaderPath;</span>
  }

  @Override
  public File getBasedir() {
<span class="fc" id="L433">    return this.mavenProject.getBasedir();</span>
  }

  private void validateParameters() throws MojoExecutionException {
<span class="fc" id="L437">    this.fileExists(&quot;customRunnerConfiguration&quot;,this.customRunnerConfiguration);</span>
<span class="fc" id="L438">    this.fileExists(&quot;customRunnerTemplate&quot;,this.customRunnerTemplate);</span>
<span class="fc" id="L439">  }</span>

  private void fileExists(String parameter, File file) throws MojoExecutionException {
<span class="pc bpc" id="L442" title="3 of 6 branches missed.">    if (file != null &amp;&amp; (!file.exists() || !file.canRead())) {</span>
<span class="nc" id="L443">      throw new MojoExecutionException(String.format(ERROR_FILE_DNE,parameter,file));</span>
    }
<span class="fc" id="L445">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.2.201302030002</span></div></body></html>