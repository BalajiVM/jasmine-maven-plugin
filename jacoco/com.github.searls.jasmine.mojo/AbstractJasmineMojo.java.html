<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AbstractJasmineMojo.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jasmine-maven-plugin</a> &gt; <a href="index.html" class="el_package">com.github.searls.jasmine.mojo</a> &gt; <span class="el_source">AbstractJasmineMojo.java</span></div><h1>AbstractJasmineMojo.java</h1><pre class="source lang-java linenums">package com.github.searls.jasmine.mojo;

import com.github.searls.jasmine.config.JasmineConfiguration;
import com.github.searls.jasmine.exception.StringifiesStackTraces;
import com.github.searls.jasmine.io.ScansDirectory;
import com.github.searls.jasmine.model.ScriptSearch;
import com.github.searls.jasmine.runner.SpecRunnerTemplate;
import com.github.searls.jasmine.thirdpartylibs.ProjectClassLoaderFactory;
import org.apache.commons.lang3.StringUtils;
import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.MojoFailureException;
import org.apache.maven.plugins.annotations.Component;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.project.MavenProject;
import org.codehaus.plexus.resource.ResourceManager;
import org.codehaus.plexus.resource.loader.FileResourceLoader;
import org.eclipse.jetty.server.Connector;
import org.eclipse.jetty.server.nio.SelectChannelConnector;

import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Map;

<span class="fc" id="L27">public abstract class AbstractJasmineMojo extends AbstractMojo implements JasmineConfiguration {</span>

	private static final String ERROR_FILE_DNE = &quot;Invalid value for parameter '%s'. File does not exist: %s&quot;;

	// Properties in order of most-to-least interesting for client projects to override

	/**
	 * Directory storing your JavaScript.
	 * @since 1.1.0
	 */
	@Parameter(
			property=&quot;jsSrcDir&quot;,
			defaultValue=&quot;${project.basedir}${file.separator}src${file.separator}main${file.separator}javascript&quot;)
	private File jsSrcDir;

	/**
	 * Directory storing your Jasmine Specs.
	 * @since 1.1.0
	 */
	@Parameter(
			property=&quot;jsTestSrcDir&quot;,
			defaultValue=&quot;${project.basedir}${file.separator}src${file.separator}test${file.separator}javascript&quot;)
	private File jsTestSrcDir;

	/**
	 * Determines the Selenium WebDriver class we'll use to execute the tests. See the Selenium documentation for more details.
	 * The plugin uses &lt;a href=&quot;http://htmlunit.sourceforge.net/&quot;&gt;HtmlUnit&lt;/a&gt; by default.
	 *
	 * &lt;p&gt;Some valid examples:&lt;/p&gt;
	 * &lt;ul&gt;
	 *   &lt;li&gt;org.openqa.selenium.htmlunit.HtmlUnitDriver&lt;/li&gt;
	 *   &lt;li&gt;org.openqa.selenium.phantomjs.PhantomJSDriver&lt;/li&gt;
	 *   &lt;li&gt;org.openqa.selenium.firefox.FirefoxDriver&lt;/li&gt;
	 *   &lt;li&gt;org.openqa.selenium.ie.InternetExplorerDriver&lt;/li&gt;
	 * &lt;/ul&gt;
	 * &lt;p/&gt;
	 * For org.openqa.selenium.phantomjs.PhantomJSDriver, see the webDriverCapabilities property.
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;org.openqa.selenium.htmlunit.HtmlUnitDriver&quot;)
	protected String webDriverClassName;

	/**
	 * &lt;p&gt;Web driver capabilities used to initialize a DesiredCapabilities instance when creating a web driver.&lt;/p&gt;
   *
	 * &lt;p&gt;Capabilities value can be either a String, a List, or a Map.&lt;/p&gt;
   *
   * &lt;p&gt;Example:&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;webDriverCapabilities&amp;gt;
   *   &amp;lt;capability&amp;gt;
   *     &amp;lt;name&amp;gt;phantomjs.binary.path&amp;lt;/name&amp;gt;
   *     &amp;lt;value&amp;gt;/opt/phantomjs/bin/phantomjs&amp;lt;/value&amp;gt;
   *   &amp;lt;/capability&amp;gt;
   *   &amp;lt;capability&amp;gt;
   *     &amp;lt;name&amp;gt;phantomjs.cli.args&amp;lt;/name&amp;gt;
   *     &amp;lt;list&amp;gt;
   *       &amp;lt;value&amp;gt;--disk-cache=true&amp;lt;/value&amp;gt;
   *       &amp;lt;value&amp;gt;--max-disk-cache-size=256&amp;lt;/value&amp;gt;
   *     &amp;lt;/list&amp;gt;
   *   &amp;lt;/capability&amp;gt;
   *   &amp;lt;capability&amp;gt;
   *     &amp;lt;name&amp;gt;proxy&amp;lt;/name&amp;gt;
   *     &amp;lt;map&amp;gt;
   *       &amp;lt;httpProxy&amp;gt;myproxyserver.com:8000&amp;lt;/httpProxy&amp;gt;
   *     &amp;lt;/map&amp;gt;
   *   &amp;lt;/capability&amp;gt;
   * &amp;lt;/webDriverCapabilities&amp;gt;
   * &lt;/pre&gt;
	 *
	 * @since 1.3.1.1
	 */
<span class="fc" id="L100">  @Parameter</span>
  protected List&lt;Capability&gt; webDriverCapabilities = Collections.emptyList();

	/**
	 * &lt;p&gt;Determines the browser and version profile that HtmlUnit will simulate. This setting does nothing if the plugin is configured not to use HtmlUnit.
	 * This maps 1-to-1 with the public static instances found in {@link com.gargoylesoftware.htmlunit.BrowserVersion}.&lt;/p&gt;
	 *
	 * &lt;p&gt;Some valid examples: CHROME, FIREFOX_17, INTERNET_EXPLORER_9, INTERNET_EXPLORER_10&lt;/p&gt;
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;FIREFOX_17&quot;)
	protected String browserVersion;

	/**
	 * &lt;p&gt;Determines the format that jasmine:test will print to console.&lt;/p&gt;
	 * &lt;p&gt;Valid options:&lt;/p&gt;
	 * &lt;ul&gt;
	 *   &lt;li&gt;&quot;documentation&quot; - (default) - print specs in a nested format&lt;/li&gt;
	 *   &lt;li&gt;&quot;progress&quot; - more terse, with a period for a passed specs and an 'F' for failures (e.g. '...F...')&lt;/li&gt;
	 * &lt;/ul&gt;
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;documentation&quot;)
	protected String format;

	/**
	 * &lt;p&gt;JavaScript sources (typically vendor/lib dependencies) that need to be loaded
	 * before other sources (and specs) in a particular order. Each source will first be
	 * searched for relative to &lt;code&gt;${jsSrcDir}&lt;/code&gt;, then &lt;code&gt;${jsTestSrcDir}&lt;/code&gt;,
	 * then (if it's not found in either) it will be included exactly as it appears in your POM.&lt;/p&gt;
	 *
	 * &lt;p&gt;Therefore, if jquery.js is in &lt;code&gt;${jsSrcDir}/vendor&lt;/code&gt;, you would configure:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;preloadSources&amp;gt;
	 *   &amp;lt;source&amp;gt;vendor/jquery.js&amp;lt;/source&amp;gt;
	 * &amp;lt;/preloadSources&amp;gt;
	 * &lt;/pre&gt;
	 * 
	 * &lt;p&gt;And jquery.js would load before all the other sources and specs.&lt;/p&gt;
	 * 
	 * @since 1.1.0
	 */
	@Parameter
	protected List&lt;String&gt; preloadSources;

	/**
	 * &lt;p&gt;It may be the case that the jasmine-maven-plugin doesn't currently suit all of your needs,
	 * and as a result the generated SpecRunner HTML files are set up in a way that you can't run
	 * your specs. Have no fear! Simply specify a custom spec runner template in the plugin configuration
	 * and make the changes you need.&lt;/p&gt;
	 * 
	 * &lt;p&gt;Potential values are a filesystem path, a URL, or a classpath resource. The default template is
	 * stored in &lt;code&gt;src/main/resources/jasmine-templates/SpecRunner.htmltemplate&lt;/code&gt;, and the
	 * required template strings are tokenized in &quot;$*$&quot; patterns.&lt;/p&gt;
	 *
	 * &lt;p&gt;Example usage:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;customRunnerTemplate&amp;gt;${project.basedir}/src/test/resources/myCustomRunner.template&amp;lt;/customRunnerTemplate&amp;gt;
	 * &lt;/pre&gt;
	 *
	 * @since 1.1.0
	 */
	@Parameter
	protected String customRunnerTemplate;

	/**
	 * &lt;p&gt;Sometimes you want to have full control over how scriptloaders are configured. In order to
	 * interpolate custom configuration into the generated runnerTemplate, specify a file containing
	 * the additional config. Potential values are a filesystem path, a URL, or a classpath resource.&lt;/p&gt;
	 *
	 * &lt;p&gt;Example usage:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;customRunnerConfiguration&amp;gt;${project.basedir}/src/test/resources/myCustomConfig.txt&amp;lt;/customRunnerConfiguration&amp;gt;
	 * &lt;/pre&gt;
	 *
	 * @since 1.1.0
	 */
	@Parameter
	protected String customRunnerConfiguration;

	/**
	 * Target directory for files created by the plugin.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;${project.build.directory}${file.separator}jasmine&quot;)
	protected File jasmineTargetDir;

	/**
	 * Skip execution of tests.
	 * 
	 * @since 1.1.0
	 * @see &lt;a href=&quot;http://maven.apache.org/general.html#skip-test&quot;&gt;http://maven.apache.org/general.html#skip-test&lt;/a&gt;
	 */
	@Parameter(property=&quot;skipTests&quot;)
	protected boolean skipTests;
	
  /**
   * Skip compilation and execution of tests.
   * 
   * @since 1.3.1.3
   * @see &lt;a href=&quot;http://maven.apache.org/general.html#skip-test&quot;&gt;http://maven.apache.org/general.html#skip-test&lt;/a&gt;
   */
	@Parameter(property=&quot;maven.test.skip&quot;)
  protected boolean mvnTestSkip;

  /**
   * Skip only jasmine tests
   *
   * @since 1.3.1.3
   */
  @Parameter(property=&quot;skipJasmineTests&quot;)
  protected boolean skipJasmineTests;

	/**
	 * Halt the build on test failure.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(property=&quot;haltOnFailure&quot;, defaultValue=&quot;true&quot;)
	protected boolean haltOnFailure;

	/**
	 * Timeout for spec execution in seconds.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;300&quot;)
	protected int timeout;

	/**
	 * True to increase HtmlUnit output and attempt reporting on specs even if a timeout occurred.
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;false&quot;)
	protected boolean debug;

	/**
	 * The name of the Spec Runner file.
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;SpecRunner.html&quot;)
	protected String specRunnerHtmlFileName;

	/**
	 * The name of the Manual Spec Runner.
	 *
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;ManualSpecRunner.html&quot;)
	protected String manualSpecRunnerHtmlFileName;

	/**
	 * The name of the generated JUnit XML report.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;TEST-jasmine.xml&quot;)
	protected String junitXmlReportFileName;

	/**
	 * The name of the directory the specs will be deployed to on the server.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;spec&quot;)
	protected String specDirectoryName;

	/**
	 * The name of the directory the sources will be deployed to on the server.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;src&quot;)
	protected String srcDirectoryName;

	/**
	 * The source encoding.
	 * 
	 * @since 1.1.0
	 */
	@Parameter(defaultValue=&quot;${project.build.sourceEncoding}&quot;)
	protected String sourceEncoding;

	/**
	 * Keep the server alive after the &lt;code&gt;jasmine:test&lt;/code&gt; goal exists.
	 * Useful if you need to run further analysis on your tests, like collecting code coverage.
	 * 
	 * @since 1.3.1.0
	 */
	@Parameter(property=&quot;keepServerAlive&quot;, defaultValue=&quot;false&quot;)
	protected boolean keepServerAlive;

	/**
   * &lt;p&gt;Allows specifying which source files should be included and in what order.&lt;/p&gt;
   * &lt;pre&gt;
	 * &amp;lt;sourceIncludes&amp;gt;
	 *   &amp;lt;include&amp;gt;vendor/&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;myBootstrapFile.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
	 * &amp;lt;/sourceIncludes&amp;gt;
	 * &lt;/pre&gt;
	 * 
	 * &lt;p&gt;Default &lt;code&gt;sourceIncludes&lt;/code&gt;:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;sourceIncludes&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
	 * &amp;lt;/sourceIncludes&amp;gt;
	 * &lt;/pre&gt;
	 * 
	 * @since 1.1.0
	 */
<span class="fc" id="L318">	@Parameter</span>
	private final List&lt;String&gt; sourceIncludes = ScansDirectory.DEFAULT_INCLUDES;

	/**
	 * &lt;p&gt;Just like &lt;code&gt;sourceIncludes&lt;/code&gt;, but will exclude anything matching the provided patterns.&lt;/p&gt;
	 * &lt;p&gt;There are no &lt;code&gt;sourceExcludes&lt;/code&gt; by default.&lt;/p&gt;
	 * 
	 * @since 1.1.0
	 */
<span class="fc" id="L327">	@Parameter</span>
	private final List&lt;String&gt; sourceExcludes = Collections.emptyList();

	/**
	 * &lt;p&gt;I often find myself needing control of the spec include order
	 * when I have some global spec helpers or spec-scoped dependencies, like:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;specIncludes&amp;gt;
	 *   &amp;lt;include&amp;gt;jasmine-jquery.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;spec-helper.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
	 * &amp;lt;/specIncludes&amp;gt;
	 * &lt;/pre&gt;
	 * 
	 * &lt;p&gt;Default &lt;code&gt;specIncludes&lt;/code&gt;:&lt;/p&gt;
	 * &lt;pre&gt;
	 * &amp;lt;specIncludes&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.js&amp;lt;/include&amp;gt;
	 *   &amp;lt;include&amp;gt;&amp;#42;&amp;#42;/&amp;#42;.coffee&amp;lt;/include&amp;gt;
	 * &amp;lt;/specIncludes&amp;gt;
	 * &lt;/pre&gt;
	 * 
	 * @since 1.1.0
	 */
<span class="fc" id="L352">	@Parameter</span>
	private final List&lt;String&gt; specIncludes = ScansDirectory.DEFAULT_INCLUDES;

	/**
	 * &lt;p&gt;Just like &lt;code&gt;specIncludes&lt;/code&gt;, but will exclude anything matching the provided patterns.&lt;/p&gt;
	 * &lt;p&gt;There are no &lt;code&gt;specExcludes&lt;/code&gt; by default.&lt;/p&gt;
	 * 
	 * @since 1.1.0
	 */
<span class="fc" id="L361">	@Parameter</span>
	private final List&lt;String&gt; specExcludes = Collections.emptyList();

	/**
	 * &lt;p&gt;Used by the &lt;code&gt;jasmine:bdd&lt;/code&gt; goal to specify port to run the server under.&lt;/p&gt;
	 * 
	 * &lt;p&gt;The &lt;code&gt;jasmine:test&lt;/code&gt; goal always uses a random available port so this property is ignored.&lt;/p&gt;
	 * 
	 * @since 1.1.0
	 */
	@Parameter(property=&quot;jasmine.serverPort&quot;, defaultValue=&quot;8234&quot;)
	protected int serverPort;

  /**
   * &lt;p&gt;Specify the URI scheme in which to access the SpecRunner.&lt;/p&gt;
   *
   * @since 1.3.1.4
   */
  @Parameter(property=&quot;jasmine.uriScheme&quot;, defaultValue=&quot;http&quot;)
  protected String uriScheme;

    /**
     * &lt;p&gt;Not used by the &lt;code&gt;jasmine:bdd&lt;/code&gt; goal.&lt;/p&gt;
     *
     * &lt;p&gt;The &lt;code&gt;jasmine:test&lt;/code&gt; goal to specify hostname where the server is running.  Useful when using
     * the RemoteWebDriver.&lt;/p&gt;
     *
     * @since 1.3.1.4
     */
    @Parameter(property=&quot;jasmine.serverHostname&quot;, defaultValue = &quot;localhost&quot;)
    protected String serverHostname;

	/**
	 * &lt;p&gt;Determines the strategy to use when generation the JasmineSpecRunner. This feature allows for custom
	 * implementation of the runner generator. Typically this is used when using different script runners.&lt;/p&gt;
	 *
	 * &lt;p&gt;Some valid examples: DEFAULT, REQUIRE_JS&lt;/p&gt;
	 * 
	 * @since 1.1.0
	 */
	@Parameter(property=&quot;jasmine.specRunnerTemplate&quot;, defaultValue=&quot;DEFAULT&quot;)
	protected SpecRunnerTemplate specRunnerTemplate;

	/**
	 * &lt;p&gt;Path to loader script, relative to jsSrcDir. Defaults to jsSrcDir/nameOfScript.js. Which script to look for is determined by
	 * the selected spcRunnerTemplate. I.e require.js is used when REQUIRE_JS is selected as specRunnerTemplate.&lt;/p&gt;
	 *
	 * @since 1.1.0
	 * @deprecated Specify script loader path using the &lt;code&gt;preloadSources&lt;/code&gt; parameter instead.
	 */
	@Parameter
	@Deprecated
	protected String scriptLoaderPath;

	/**
	 * &lt;p&gt;Automatically refresh the test runner at the given interval (specified in seconds) when using the &lt;code&gt;jasmine:bdd&lt;/code&gt; goal.&lt;/p&gt;
	 * &lt;p&gt;A value of &lt;code&gt;0&lt;/code&gt; disables the automatic refresh (which is the default).&lt;/p&gt;
	 * 
	 * @since 1.3.1.1
	 */
	@Parameter(property=&quot;jasmine.autoRefreshInterval&quot;, defaultValue=&quot;0&quot;)
	protected int autoRefreshInterval;

	/**
	 * &lt;p&gt;Control the Coffee Script compilation.  e.g. When using RequireJS the compilation
	 * happens within the Coffee Script AMD loader plugin; we therefore need to disable the 
	 * compilation here.&lt;/p&gt;
	 *
	 * @since 1.3.1.4
	 */
	@Parameter(property=&quot;coffeeScriptCompilationEnabled&quot;, defaultValue=&quot;true&quot;)
	protected boolean coffeeScriptCompilationEnabled;
	
  /**
   * &lt;p&gt;Type of {@link org.eclipse.jetty.server.Connector} to use on the jetty server.&lt;/p&gt;
   *
   * &lt;p&gt;Most users won't need to change this from the default value. It should only be used
   * by advanced users.&lt;/p&gt;
   *
   * @since 1.3.1.4
   */
  @Parameter(
      property=&quot;jasmine.connectorClass&quot;,
      defaultValue=&quot;org.eclipse.jetty.server.nio.SelectChannelConnector&quot;
  )
  protected String connectorClass;

  /**
   * &lt;p&gt;Specify additional contexts to make available.&lt;/p&gt;
   * &lt;pre&gt;
   * &amp;lt;additionalContexts&amp;gt;
   *   &amp;lt;context&amp;gt;
   *     &amp;lt;contextRoot&amp;gt;/lib&amp;lt;/contextRoot&amp;gt;
   *     &amp;lt;directory&amp;gt;${project.basedir}/src/main/lib&amp;lt;/directory&amp;gt;
   *   &amp;lt;/context&amp;gt;
   *   &amp;lt;context&amp;gt;
   *     &amp;lt;contextRoot&amp;gt;/test/lib&amp;lt;/contextRoot&amp;gt;
   *     &amp;lt;directory&amp;gt;${project.basedir}/src/test/lib&amp;lt;/directory&amp;gt;
   *   &amp;lt;/context&amp;gt;
   * &amp;lt;/additionalContexts&amp;gt;
   * &lt;/pre&gt;
   *
   * @since 1.3.1.5
   */
<span class="fc" id="L465">  @Parameter</span>
  private List&lt;Context&gt; additionalContexts = Collections.emptyList();

  @Parameter(defaultValue=&quot;${project}&quot;, readonly=true)
	protected MavenProject mavenProject;

	@Component
	protected ResourceManager locator;

	protected ScriptSearch sources;
	protected ScriptSearch specs;

<span class="fc" id="L477">	protected StringifiesStackTraces stringifiesStackTraces = new StringifiesStackTraces();</span>

	private File customRunnerTemplateFile;
	private File customRunnerConfigurationFile;


	@Override
	public void execute() throws MojoExecutionException, MojoFailureException {

<span class="fc" id="L486">		this.loadResources();</span>

<span class="fc" id="L488">		this.sources = new ScriptSearch(this.jsSrcDir,this.sourceIncludes,this.sourceExcludes);</span>
<span class="fc" id="L489">		this.specs = new ScriptSearch(this.jsTestSrcDir,this.specIncludes,this.specExcludes);</span>

		try {
<span class="fc" id="L492">			this.run();</span>
<span class="fc" id="L493">		} catch(MojoFailureException e) {</span>
<span class="fc" id="L494">			throw e;</span>
<span class="fc" id="L495">		} catch(Exception e) {</span>
<span class="fc" id="L496">			throw new MojoExecutionException(&quot;The jasmine-maven-plugin encountered an exception: \n&quot;+this.stringifiesStackTraces.stringify(e),e);</span>
<span class="fc" id="L497">		}</span>
<span class="fc" id="L498">	}</span>

	public abstract void run() throws Exception;

	@Override
	public String getSourceEncoding() {
<span class="fc" id="L504">		return this.sourceEncoding;</span>
	}

	@Override
	public File getCustomRunnerTemplate() {
<span class="fc" id="L509">		return this.customRunnerTemplateFile;</span>
	}

	@Override
	public SpecRunnerTemplate getSpecRunnerTemplate() {
<span class="nc" id="L514">		return this.specRunnerTemplate;</span>
	}

	@Override
	public File getJasmineTargetDir() {
<span class="nc" id="L519">		return this.jasmineTargetDir;</span>
	}

	@Override
	public String getSrcDirectoryName() {
<span class="nc" id="L524">		return this.srcDirectoryName;</span>
	}

	@Override
	public ScriptSearch getSources() {
<span class="nc" id="L529">		return this.sources;</span>
	}

	@Override
	public ScriptSearch getSpecs() {
<span class="nc" id="L534">		return this.specs;</span>
	}

	@Override
	public String getSpecDirectoryName() {
<span class="nc" id="L539">		return this.specDirectoryName;</span>
	}

	@Override
	public List&lt;String&gt; getPreloadSources() {
<span class="nc" id="L544">		this.addRequireJsIfNecessary(); // This is temporary until the scriptLoaderPath parameter is removed</span>
<span class="nc" id="L545">		return this.preloadSources;</span>
	}

	private void addRequireJsIfNecessary() {
<span class="nc bnc" id="L549" title="All 2 branches missed.">		String scriptLoaderPath = this.getScriptLoaderPath() == null ? &quot;require.js&quot; : this.getScriptLoaderPath();</span>
<span class="nc" id="L550">		String requireJsPath = String.format(&quot;%s/%s&quot;, this.jsSrcDir, scriptLoaderPath);</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">		if (SpecRunnerTemplate.REQUIRE_JS.equals(this.specRunnerTemplate)) {</span>
<span class="nc" id="L552">			File requireJsFile = new File(requireJsPath);</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">			if (requireJsFile.exists()) {</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">				if (this.preloadSources == null) {</span>
<span class="nc" id="L555">					this.preloadSources = new ArrayList&lt;String&gt;();</span>
				}
<span class="nc" id="L557">				this.preloadSources.add(requireJsPath);</span>
			}
		}
<span class="nc" id="L560">	}</span>

	@Override
	public int getAutoRefreshInterval() {
<span class="fc" id="L564">		return this.autoRefreshInterval;</span>
	}

	@Override
	public boolean isCoffeeScriptCompilationEnabled() {
<span class="nc" id="L569">		return this.coffeeScriptCompilationEnabled;</span>
	}

	public MavenProject getMavenProject() {
<span class="fc" id="L573">		return this.mavenProject;</span>
	}

	@Override
	public File getCustomRunnerConfiguration() {
<span class="fc" id="L578">		return this.customRunnerConfigurationFile;</span>
	}

	@Deprecated
	@Override
	public String getScriptLoaderPath() {
<span class="fc" id="L584">		return this.scriptLoaderPath;</span>
	}

	@Override
	public File getBasedir() {
<span class="fc" id="L589">		return this.mavenProject.getBasedir();</span>
	}

  @Override
  public ClassLoader getProjectClassLoader() {
<span class="nc" id="L594">     return new ProjectClassLoaderFactory(mavenProject.getArtifacts()).create();</span>
  }

  @Override
  public List&lt;Context&gt; getContexts() {
<span class="nc" id="L599">    List&lt;Context&gt; contexts = new ArrayList&lt;Context&gt;();</span>
<span class="nc" id="L600">    contexts.add(new Context(this.srcDirectoryName, this.jsSrcDir));</span>
<span class="nc" id="L601">    contexts.add(new Context(this.specDirectoryName, this.jsTestSrcDir));</span>
<span class="nc" id="L602">    contexts.addAll(additionalContexts);</span>
<span class="nc" id="L603">    return contexts;</span>
  }

  protected Connector getConnector() throws MojoExecutionException {
    try {
      @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L609">      Class&lt;? extends Connector&gt; c = (Class&lt;? extends Connector&gt;) Class.forName(connectorClass);</span>
<span class="nc" id="L610">      return c.newInstance();</span>
<span class="nc" id="L611">    } catch(InstantiationException e) {</span>
<span class="nc" id="L612">      throw new MojoExecutionException(&quot;Unable to instantiate.&quot;,e);</span>
<span class="nc" id="L613">    } catch (IllegalAccessException e) {</span>
<span class="nc" id="L614">      throw new MojoExecutionException(&quot;Unable to instantiate.&quot;,e);</span>
<span class="nc" id="L615">    } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L616">      throw new MojoExecutionException(&quot;Unable to instantiate.&quot;,e);</span>
    }
  }

  protected boolean isSkipTests() {
<span class="pc bpc" id="L621" title="5 of 6 branches missed.">    return this.skipTests || this.mvnTestSkip || this.skipJasmineTests;</span>
  }

	private void loadResources() throws MojoExecutionException {
<span class="fc" id="L625">		this.customRunnerTemplateFile = this.getResourceAsFile(&quot;customRunnerTemplate&quot;, this.customRunnerTemplate);</span>
<span class="fc" id="L626">		this.customRunnerConfigurationFile = this.getResourceAsFile(&quot;customRunnerConfiguration&quot;, this.customRunnerConfiguration);</span>
<span class="fc" id="L627">	}</span>

	private File getResourceAsFile(String parameter, String resourceLocation) throws MojoExecutionException {
<span class="fc" id="L630">		File file = null;</span>

<span class="fc bfc" id="L632" title="All 2 branches covered.">		if (resourceLocation != null) {</span>
<span class="fc" id="L633">			this.locator.addSearchPath( &quot;url&quot;, &quot;&quot; );</span>
<span class="fc" id="L634">			this.locator.addSearchPath( FileResourceLoader.ID, this.mavenProject.getFile().getParentFile().getAbsolutePath() );</span>

<span class="fc" id="L636">			ClassLoader origLoader = Thread.currentThread().getContextClassLoader();</span>
			try {
<span class="fc" id="L638">				Thread.currentThread().setContextClassLoader(this.getClass().getClassLoader());</span>
				try {
<span class="fc" id="L640">					file = this.locator.getResourceAsFile(resourceLocation);</span>
<span class="fc" id="L641">				} catch (Exception e) {</span>
<span class="fc" id="L642">					throw new MojoExecutionException(String.format(ERROR_FILE_DNE,parameter,resourceLocation));</span>
<span class="fc" id="L643">				}</span>
			}
			finally {
<span class="fc" id="L646">				Thread.currentThread().setContextClassLoader( origLoader );</span>
<span class="fc" id="L647">			}</span>
		}
<span class="fc" id="L649">		return file;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.2.201302030002</span></div></body></html>